ТЕХНИЧЕСКОЕ ЗАДАНИЕ
Цели тестирования: 
Провести тестирование с целью определения пределов производительности и обеспечения неухудшения производительности программно-аппаратного комплекса PSB Corporate по сравнению с целевыми показателям, закреплённым в настоящем приложении (Профиль PSB Corporate), путем определения узких мест (неоптимально работающих участков кода, настроек базы данных, неоптимально работающих запросов в БД и т.п.), выработкой рекомендации по их устранению и оценкой работы системы после выполнения рекомендаций по оптимизации системы.
Технические цели:
Определить производительность программно-аппаратного комплекса PSB Corporate путем эмуляции работы пользователя системы с постепенным повышение интенсивности выполнения операций в системе. 
Локализовать узкие места.
Выработать варианты оптимизации и решения найденных проблем.
После оптимизации системы разработчиками Заказчика, оценить влияние исправлений.
Определить необходимый уровень автоматизации системы сбора метрик, создания отчетов, необходимый для встраивания системы нагрузочного тестирования в процесс непрерывной интерграции и развертывания. Провести работы по автоматизации процесса нагрузочного тестирования. В состав работ по автоматизации входят следующие виды работ:
Хранение метрик dotnet в БД и последующая визуализация в Grafana
Сбор уникальных запросов из TOP-25 QueryStore 
Сессионная модель логина в программно-аппаратный комплекс PSB Corporate
Провести документирование процесса тестирования включая, но не ограничиваясь, описанием работы системы, заглушек, скриптов, сценариев. Используемый инструмент – confluence.
Провести тест на определение максимальной производительности не менее 2 раз за релиз; (24 итерации тестов – 12 тестирований ежемесячных релизов, и 12 межрезлизных тестов). Описание теста приведено в методике нагрузочного тестирования (приложение 2).
Провести тест на стабильность не менее 1 раза за 3 релиза; (4 итерации тестов – 1 ежеквартальный тест). Описание теста приведено в методике нагрузочного тестирования (приложение 2).
Условия:
 Объект тестирования (программно-аппаратный комплекс PSB Corporate) – Система дистанционного банковского обслуживания с функционалом, позволяющем крупным холдингам осуществлять полный спектр необходимых действий для осуществления своей деятельности.
Работы, проводимые в рамках данного технического задания, разделены на 2 этапа длительностью 6 релизов каждый. Распределение работ по этапам – равномерное.
Базовый профиль нагрузки для программно-аппаратного комплекса PSB Corporate собран и зафиксирован (приложение 1). Повторный пересмотр не требуется.
Целевой инструмент – Jmeter. Необходимо проводить рефакторинг и актуализацию скриптов после каждого внедренного, со стороны Заказчика исправления на стороне объекта тестирования. 
Необходимо разработать новые скрипты и сценарии (Предположительно не более 5 СНТ)
Необходимо разработать систему сбора уникальных запросов из TOP-25 QueryStore (mssql)
Необходимо разработать систему хранения метрик dotnet в БД и последующую их визуализацию в Grafana
Необходимо разработать заглушку, эмулирующую работу логина в программно-аппаратный комплекс PSB Corporate
Набор систем-заглушек, эмулирующий работу смежных систем относительно объекта тестирования и скриптов из п 3.4. Необходимо проводить рефакторинг и актуализацию систем-заглушек после каждого внедренного со стороны Заказчика исправления на стороне объекта тестирования. 
Средства мониторинга настроены. Мониторинг осуществляется посредством инструментов Telegraf+InfluxDB+Grafana.
Необходимо проводить актуализацию описательной документации системы после каждого внедренного со стороны Заказчика исправления на стороне объекта тестирования.
Целевые испытания должны сопровождаться обязательной генерацией синтетических данных для наполнения БД, с целью симуляции работы ПО в течении 0,5 года. Работы по генерации данных в БД на свежей базе включают в себя:
Создание нового пользователя со всеми правами на чистой базе (силами разработчиков). Один раз для базы.
Генерация пользователей банка скриптом (уже разработан)
Присвоение универсального пароля (скрипт sql имеется)
Генерация пользователей клиента скриптом (уже разработан)
Генерация сертификатов для пользователей банка (скрипт имеется)
Присвоение универсального пароля (скрипт sql имеется)
Дополнительные требования для проведения НТ:
Размещение артефактов (разработанных и актуализированных скриптов эмуляции действий пользователей, исходных кодов разработанных и актуализированных систем-заглушек, инструкций по использованию всего разработанного в рамках предоставления услуг по настоящему заданию) в системе контроля версий.


Приложение 1
Базовый профиль 


Профиль - клиентская часть

UC
Операция
Профиль 100%.
Операций в час

1
Авторизация (клиент)
4147

2
РПП ГОЗ
3052

3
РПП
2984

4
Выписка 2 дня
4115

5
Письмо
274

6
Заявление на отзыв из обработки рублёвого платежного поручения
192

7
Реестр на перечисление заработной платы
243

8
Выписка 1C
1432

9
Выписка большой срок
255

10
Директ банк: запрос выписки
152

11
Директ банк: получение выписки
152

12
Акцепт
29

13
РПП на Акцепт
29

14
Реестр на выпуск карт
17

15
Директ банк: РПП
152


Профиль - банковская часть

16
Авторизация (банк)
347

17
Импорт счета
86

18
Письмо клиенту
457

19
Создание пользователя организации
9

20
Ручное заведение счета
8

21
Создание организации
5

22
Исходящее платёжное требование
48

23
Создание банковского пользователя
2

24
Синхронизация остатков на счетах (1000 счетов раз в 1 минуту)
60


Низкоинтенсивные операции, выполняемые на каждой ступени теста один раз

25
Создание корпораций (20 корпораций).


26
Массовая рассылка писем клиентам (50 000 получателей)


27
Импорт валютных операций (15 000 операций)


28
Заявление на перевод валюты (5 000 операций)


29
Информация о валютных операциях (2 500)


30
Отображение большого количества документов на странице пользователя (1 000)

31
Формирование отчёта по корпоративным картам (30 отчётов по 100 счетов)


32
Формирование отчёта по корпоративным карточным счетам (30 отчётов по 100 счетов)

33
Синхронизация остатков на счетах (500 000 счетов единовременно)




Приложение 2
Методика проведения тестирования 
Тест на определение максимальной производительности
Цели теста: 
•	Определение уровня максимальной производительности
•	Определение, справляется ли система с целевой нагрузкой
•	Выявление узких мест

Подготовка к тесту:
В ходе подготовки к тесту будут подготовлены пулы данных (клиенты, организации, счета, контракты, транзакции, документы и т.д) в объёме, необходимом для создания целевой нагрузки при выполнении бизнес-кейсов профиля. 
Так же на всех серверах объекта тестирования будет настроен мониторинг метрик производительности.
Проведение теста:
В ходе тестирования уровень нагрузки наращивается ступенчато до предельного уровня, при котором система становится неработоспособной. Увеличение уровня нагрузки производится путём увеличения количества виртуальный пользователей, выполняющий бизнес-кейсы, в соответствии с профилем тестирования. Нагрузка увеличивается ступеньками начиная с 100% профиля до 300% профиля (соответствует целевой производительности) с шагом по 50%. Длительность ступеньки составляет 20 минут. 
Размер и длительность ступенек могут быть пересмотрены в ходе тестирования в зависимости от результатов отладочных тестов.
Критериями завершения теста являются:
•	Нарушение критериев работоспособности системы
Критериями успешного завершения теста являются:
•	Измерение времени отклика системы по всем операциям профиля;
•	получение данных мониторинга утилизации аппаратных ресурсов;
•	в процессе тестирования нагрузка подавалась с интенсивностью, соответствующей профилю тестирования (отклонение от профиля тестирования не более 10%).
Критериями работоспособности системы являются:
•	Время отклика при выполнении операций в соответствии с базовым профилем 
•	Количество ошибок при выполнении операций не более 10%.

Тест на стабильность
Цель теста: Оценка влияния длительной нагрузки на производительность, времена отклика, количество ошибок, утилизация ресурсов, поиск утечек оперативной памяти и т.д. Определение узкого места в работе системы и выработка рекомендаций по оптимизации производительности системы.
Для достижения этой цели может проводиться комплекс мер по анализу работы системы: сбор дополнительных метрик, профилирование, анализ лог-файлов, формируемых с максимальной подробностью и т.д. Настройки системы могут отличаться от продуктивных, а профиль нагрузки - отличаться от базового.
Проведение теста:
Длительность теста не менее 12 часов. Подаётся нагрузка на уровне 80% от максимальной производительности, обнаруженной в тесте на определение максимальной производительности.
Критериями успешного завершения тестирования являются: 
•	Сбор информации, позволяющей сделать выводы о работе системы в течение длительного времени, а так же об узком месте в работе системы и выработка рекомендаций по оптимизации производительности системы.
Мониторинг производительности
Во время нагрузочного тестирования наблюдаются следующие параметры:
Метрики, собираемые средствами подачи нагрузки во время тестирования:
-	время отклика при регистрации UC в разбивке по операциям (операции указаны в базовом профиле);
-	время отклика при регистрации UC целиком;
-	время взаимодействия с заглушками внешних систем;
-	количество успешных и неуспешно обработанных UC (производительность системы в разбивке по UC);
-	причины ошибок (при их наличии);
По завершению каждого теста собираются следующие метрики:
-	суммарная длина очередей RabbitMQ в ходе теста;
-	время, требуемое для обработки UC по статистике, выгружаемой из БД;
-	утилизация ресурсов балансировщиков (в связи с отсутствием доступа к системе мониторинга, собирается специалистами заказчика).
На windows-серверах метрики производительности наблюдаются с помощью Windows Performance Monitor. Полный набор метрик доступен в приложениях к МНТ. Основные метрики перечислены ниже: 
Серверы приложений
Процессор:
-	утилизация процессора (в т.ч. по ядрам);
-	процессорная очередь.
Память:
-	свободная память (в Mb);
-	утилизация памяти (в Mb);
-	скорость страничного обмена;
-	использование файла подкачки;
-	размер системного кэша.
Диск:
-	объём ввода-вывода в МБ/с;
-	количество операций чтения/записи по каждому диску в отдельности;
-	время отклика операций чтения/записи по каждому диску в отдельности;
-	средний размер очереди операций чтения/записи по каждому диску в отдельности;
-	свободный объем по каждому логическому разделу в отдельности.
Сеть:
-	количество сетевых соединений;
-	объем передаваемой информации в секунду (входящий/исходящий).

Сервер СУБД
Для сервера СУБД дополнительно собираются специфические метрики:
Метрики SQL Server:
-	ОGeneral Statistics\*;
-	SQL Statistics\*;
-	Transactions\*;
-	Memory Manager\*;
-	Buffer manager\*;
-	Plan Cache\*;
-	Статистика выполнений (Exec Statistics\*).
